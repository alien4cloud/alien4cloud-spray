
- name: Install nfs-utils
  yum:
    pkg: nfs-utils
    state: present
    update_cache: true
  become: true

- name: Here is the working directory
  debug:
    var: working_directory

- name: Get the parent dir of the working directory
  shell: "echo $(dirname \"{{ working_directory }}\")"
  register: dirname_command_output

- name:
  set_fact:
    mount_directory: "{{ dirname_command_output.stdout }}"

- name: Here is the mount directory
  debug:
    var: mount_directory

- name: Creates NFS mount directory
  become: true
  file:
    path: "{{ mount_directory }}"
    state: directory

- name: UnMount NFS share
  become: true
  ignore_errors: yes
  shell: "umount {{ mount_directory }}"

- name: Mount NFS share
  become: true
  shell: "mount {{ nfs_share }} {{ mount_directory }}"

- name: Ensure working directory exists
  become: true
  file:
    path: "{{ working_directory }}"
    state: directory

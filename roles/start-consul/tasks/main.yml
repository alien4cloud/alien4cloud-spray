
- name: Start consul
  service:
    name: consul
    state: started
    enabled: yes
  become: true
  when: ansible_distribution == 'CentOS' or ansible_distribution == 'Red Hat Enterprise Linux'

- name: Ensure consul is running
  command: systemctl status consul
  ignore_errors: false
  when: ansible_distribution == 'CentOS' or ansible_distribution == 'Red Hat Enterprise Linux'

- name: Start consul
  shell:
    chdir: ~/consul
    cmd: nohup consul agent -ui -client 0.0.0.0 -server -bootstrap-expect 1 -data-dir ./data &
  when: ansible_distribution != 'CentOS' and ansible_distribution != 'Red Hat Enterprise Linux'

- name: Ensure consul is running
  shell:
    cmd: ps -ef |grep consul |grep -v grep
  when: ansible_distribution != 'CentOS' and ansible_distribution != 'Red Hat Enterprise Linux'
